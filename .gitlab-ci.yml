include:
  - template: "Workflows/MergeRequest-Pipelines.gitlab-ci.yml"

image: python:3.9

variables:
  POETRY_CACHE_DIR: "$CI_PROJECT_DIR/.cache"

cache:
  paths:
    - .cache

before_script:
  - |
    if ! command -v poetry &> /dev/null
    then
      curl -sSL https://install.python-poetry.org | POETRY_HOME=/usr python3 -
    fi
  - poetry install

build:
  script:
    - poetry build

tests (arch):
  tags: [shell, envinf]
  script:
    - poetry run tox -p
  coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml

tests:
  script:
    - poetry run tox -p
