workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'

image: python:3.9

variables:
  POETRY_CACHE_DIR: "$CI_PROJECT_DIR/.cache"

cache:
  paths:
    - .cache

before_script:
  - curl -sSL https://install.python-poetry.org | POETRY_HOME=/usr python3 -
  - poetry install

checks:
  script:
    - poetry run pre-commit install
    - poetry run pre-commit run --all-files

build:
  script:
    - poetry build

tests:
  script:
    - poetry run pytest
